# An√°lisis Profundo del Backend - Aura Server

## üìã Resumen Ejecutivo

El backend de Aura est√° compuesto por **4 microservicios** independientes que implementan una arquitectura distribuida para una plataforma de reconexi√≥n humana. La aplicaci√≥n utiliza dos sistemas de bases de datos: **PostgreSQL** para servicios cr√≠ticos de autenticaci√≥n y notificaciones, y **MySQL** para servicios de contenido social y mensajer√≠a.

---

## üèóÔ∏è Arquitectura General

### Microservicios Identificados

1. **auth-service-aura** - Servicio de Autenticaci√≥n y Gesti√≥n de Usuarios
2. **social-service** - Servicio de Red Social (Publicaciones, Perfiles, Comunidades)
3. **aura-messaging-service** - Servicio de Mensajer√≠a en Tiempo Real
4. **notifications-service-aura** - Servicio de Notificaciones Push

### Stack Tecnol√≥gico por Microservicio

| Microservicio | Base de Datos | ORM/Query Builder | Tecnolog√≠as Clave |
|--------------|---------------|-------------------|-------------------|
| auth-service-aura | PostgreSQL | Prisma | bcryptjs, JWT, Firebase Admin |
| social-service | MySQL | Sequelize | Cloudinary, Express |
| aura-messaging-service | MySQL | Sequelize | Socket.io, JWT |
| notifications-service-aura | PostgreSQL | Prisma | Firebase Cloud Messaging |

---

## 1Ô∏è‚É£ AUTH-SERVICE-AURA

### üìä Capa de Persistencia

**Base de Datos:** PostgreSQL  
**Ubicaci√≥n:** Variable de entorno `DATABASE_URL`  
**ORM:** Prisma

#### Modelos de Datos

##### **1. Users (tabla: `users`)**
- **user_id**: UUID (PK) - Identificador √∫nico del usuario
- **username**: VARCHAR(100) UNIQUE - Nombre de usuario
- **email**: VARCHAR(100) UNIQUE - Correo electr√≥nico
- **password_hash**: VARCHAR(255) - Contrase√±a encriptada con bcrypt
- **id_role**: INT FK ‚Üí roles.id_role - Rol del usuario (default: 2)
- **created_at**: TIMESTAMP - Fecha de creaci√≥n

**Relaciones:**
- Pertenece a un Role (n:1)
- Tiene m√∫ltiples DeviceTokens (1:n)
- Tiene m√∫ltiples PasswordResets (1:n)

##### **2. Roles (tabla: `roles`)**
- **id_role**: INT SERIAL (PK)
- **role_name**: VARCHAR(50) UNIQUE - Nombre del rol
- **created_at**: TIMESTAMP

**Roles del Sistema:**
- Admin (id_role: 1)
- User (id_role: 2 - por defecto)

##### **3. DeviceTokens (tabla: `device_tokens`)**
- **id**: INT SERIAL (PK)
- **user_id**: UUID FK ‚Üí users.user_id (CASCADE DELETE)
- **token**: VARCHAR(255) - Token FCM de Firebase
- **created_at**: TIMESTAMP

**√çndices √∫nicos:** (user_id, token) - Previene tokens duplicados

##### **4. PasswordResets (tabla: `password_resets`)**
- **id**: INT SERIAL (PK)
- **user_id**: UUID FK ‚Üí users.user_id (CASCADE DELETE)
- **token**: VARCHAR(64) UNIQUE - Token de recuperaci√≥n
- **expires_at**: TIMESTAMP - Fecha de expiraci√≥n
- **created_at**: TIMESTAMP
- **used**: BOOLEAN DEFAULT false - Indica si fue usado

### üîß L√≥gica de Negocio

#### Operaciones Principales

1. **Registro de Usuarios ([register](file:///home/luis/Documents/00INTEGRADOR/aura_server/auth-service-aura/src/controllers/authController.js#7-86))**
   - Valida datos de entrada (username, email, password)
   - Encripta contrase√±a con bcrypt (10 salt rounds)
   - Asigna rol "user" por defecto (id_role=2)
   - Crea usuario en PostgreSQL
   - Genera token JWT con expiraci√≥n de 7d

2. **Autenticaci√≥n ([login](file:///home/luis/Documents/00INTEGRADOR/aura_server/auth-service-aura/src/controllers/authController.js#87-146))**
   - Valida credenciales (email/username + password)
   - Compara hash con bcrypt
   - Genera token JWT
   - Almacena deviceToken (FCM) para notificaciones push
   - Retorna datos del usuario + token

3. **Recuperaci√≥n de Contrase√±a ([recoverPassword](file:///home/luis/Documents/00INTEGRADOR/aura_server/auth-service-aura/src/controllers/authController.js#148-204))**
   - Valida existencia del email
   - Genera token criptogr√°fico aleatorio (32 bytes)
   - Almacena token con expiraci√≥n (24h)
   - **Pendiente:** Integraci√≥n con servicio de email

4. **Reseteo de Contrase√±a ([resetPassword](file:///home/luis/Documents/00INTEGRADOR/aura_server/auth-service-aura/src/controllers/authController.js#205-243))**
   - Valida token no expirado y no usado
   - Encripta nueva contrase√±a
   - Marca token como usado
   - Actualiza password_hash del usuario

5. **Gesti√≥n de Sesi√≥n**
   - [getProfile](file:///home/luis/Documents/00INTEGRADOR/aura_server/auth-service-aura/src/controllers/authController.js#244-260): Obtiene perfil del usuario autenticado
   - [logout](file:///home/luis/Documents/00INTEGRADOR/aura_server/auth-service-aura/src/controllers/authController.js#319-334): Elimina deviceToken del usuario
   - [deleteAccountByUser](file:///home/luis/Documents/00INTEGRADOR/aura_server/auth-service-aura/src/controllers/authController.js#335-347): Elimina cuenta y datos relacionados (CASCADE)

6. **Consultas P√∫blicas**
   - [getAllUsersPublic](file:///home/luis/Documents/00INTEGRADOR/aura_server/auth-service-aura/src/controllers/authController.js#271-318): Retorna lista de usuarios con paginaci√≥n
   - [getAllUsers](file:///home/luis/Documents/00INTEGRADOR/aura_server/auth-service-aura/src/controllers/authController.js#261-270): Lista completa (solo admin)

### üí° L√≥gica de Aplicaci√≥n

- **Middleware de autenticaci√≥n**: Valida JWT en headers
- **Middleware de roles**: Verifica permisos (admin/user)
- **Validaci√≥n de entrada**: Express-validator en todas las rutas
- **Seguridad**: 
  - Helmet para headers HTTP
  - CORS configurado
  - Rate limiting (pendiente)
- **Integraci√≥n Firebase**: Almacena tokens FCM para push notifications

### üìç Ubicaci√≥n de Datos

```
PostgreSQL Database (DATABASE_URL)
‚îú‚îÄ‚îÄ users
‚îú‚îÄ‚îÄ roles  
‚îú‚îÄ‚îÄ device_tokens
‚îî‚îÄ‚îÄ password_resets
```

---

## 2Ô∏è‚É£ SOCIAL-SERVICE

### üìä Capa de Persistencia

**Base de Datos:** MySQL (`posts_dev_db`)  
**Usuario:** posts_user / posts123  
**ORM:** Sequelize

#### Modelos de Datos

##### **1. UserProfiles (tabla: `user_profiles`)**
Perfil social completo del usuario.

**Campos Principales:**
- **id**: CHAR(36) PK - UUID del perfil
- **user_id**: CHAR(36) UNIQUE - Referencia al auth-service
- **display_name**: VARCHAR(100) NOT NULL - Nombre p√∫blico
- **bio**: VARCHAR(500) - Biograf√≠a
- **avatar_url**: VARCHAR(500) NOT NULL - Avatar (Cloudinary)
- **cover_url**: TEXT - Imagen de portada
- **location**: VARCHAR(100) - Ubicaci√≥n
- **website**: VARCHAR(255) - Sitio web
- **birth_date**: DATE - Fecha de nacimiento
- **gender**: ENUM('male', 'female', 'other', 'prefer_not_to_say')

**M√©tricas Sociales:**
- **followers_count**: INT DEFAULT 0
- **following_count**: INT DEFAULT 0
- **posts_count**: INT DEFAULT 0

**Estado:**
- **is_verified**: BOOLEAN DEFAULT false - Cuenta verificada
- **is_active**: BOOLEAN DEFAULT true
- **last_active_at**: TIMESTAMP
- **privacy_settings**: JSON - Configuraci√≥n de privacidad
- **preferences**: JSON - Preferencias del usuario

**Timestamps:** created_at, updated_at

##### **2. Publications (tabla: `posts`)**
Publicaciones de usuarios en la red social.

- **id**: CHAR(36) PK
- **user_id**: CHAR(36) FK
- **content**: TEXT - Contenido textual
- **type**: ENUM('text', 'image', 'video', 'text_image', 'text_video')
- **visibility**: ENUM('public', 'private', 'friends') DEFAULT 'public'
- **location**: VARCHAR(255) - Geolocalizaci√≥n opcional
- **tags**: JSON - Etiquetas de la publicaci√≥n
- **metadata**: JSON - Metadatos adicionales
- **likes_count**: INT DEFAULT 0
- **comments_count**: INT DEFAULT 0
- **shares_count**: INT DEFAULT 0
- **is_active**: BOOLEAN DEFAULT true
- **created_at**, **updated_at**

##### **3. MediaItems (tabla: `media`)**
Archivos multimedia asociados a publicaciones.

- **id**: CHAR(36) PK
- **post_id**: CHAR(36) FK ‚Üí posts.id
- **type**: ENUM('image', 'video', 'audio', 'document')
- **url**: TEXT NOT NULL - URL de Cloudinary
- **public_id**: VARCHAR(500) - ID p√∫blico de Cloudinary
- **original_name**: VARCHAR(500)
- **mime_type**: VARCHAR(100)
- **size**: BIGINT - Tama√±o en bytes
- **width**, **height**: INT - Dimensiones (im√°genes/videos)
- **duration**: FLOAT - Duraci√≥n en segundos (videos/audios)
- **format**: VARCHAR(20) - jpg, png, mp4, etc.
- **alt_text**: TEXT - Accesibilidad
- **metadata**: JSON
- **order_position**: INT DEFAULT 1 - Orden en el post
- **is_primary**: BOOLEAN DEFAULT false
- **created_at**, **updated_at**

##### **4. Comments (tabla: `comments`)**
Sistema de comentarios con respuestas anidadas.

- **id**: CHAR(36) PK
- **post_id**: CHAR(36) FK ‚Üí posts.id
- **user_id**: CHAR(36) - Usuario que comenta
- **parent_id**: CHAR(36) NULLABLE - Comentario padre (respuestas)
- **content**: TEXT NOT NULL
- **likes_count**: INT DEFAULT 0
- **replies_count**: INT DEFAULT 0
- **level**: INT DEFAULT 1 - Nivel de anidaci√≥n
- **is_edited**: BOOLEAN DEFAULT false
- **is_active**: BOOLEAN DEFAULT true
- **edited_at**: TIMESTAMP NULLABLE
- **created_at**, **updated_at**

##### **5. Likes (tabla: `likes`)**
Sistema de reacciones polim√≥rficas.

- **id**: CHAR(36) PK
- **user_id**: CHAR(36) - Usuario que reaccion√≥
- **likeable_type**: ENUM('post', 'comment') - Tipo de entidad
- **likeable_id**: CHAR(36) - ID de la entidad
- **type**: ENUM('like', 'dislike', 'love', 'angry', 'sad', 'wow') DEFAULT 'like'
- **created_at** (sin updated_at)

**√çndice √∫nico:** (user_id, likeable_id, likeable_type) - Una reacci√≥n por usuario/entidad

##### **6. Communities (tabla: `communities`)**
Comunidades tem√°ticas para agrupaci√≥n de usuarios.

- **id**: CHAR(36) PK
- **creator_id**: CHAR(36) - Usuario creador
- **name**: VARCHAR(100) NOT NULL
- **description**: TEXT
- **category**: ENUM('Deportes', 'Arte', 'M√∫sica', 'Lectura', 'Tecnolog√≠a', 'Naturaleza', 'Voluntariado', 'Gaming', 'Fotograf√≠a', 'Cocina', 'Baile', 'Meditaci√≥n')
- **tags**: JSON DEFAULT []
- **community_image_url**: VARCHAR(500)
- **members_count**: INT DEFAULT 1
- **is_active**: BOOLEAN DEFAULT true
- **created_at**, **updated_at**

##### **7. CommunityMembers (tabla: `community_members`)**
Relaci√≥n usuarios-comunidades con roles.

- **id**: CHAR(36) PK
- **community_id**: CHAR(36) FK ‚Üí communities.id
- **user_id**: CHAR(36) - Miembro
- **role**: ENUM('creator', 'admin', 'moderator', 'member') DEFAULT 'member'
- **joined_at**: TIMESTAMP

**√çndice √∫nico:** (community_id, user_id)

##### **8. Friendships (tabla: `friendships`)**
Relaciones de amistad entre usuarios.

- **id**: CHAR(36) PK
- **requester_id**: CHAR(36) - Usuario que env√≠a solicitud
- **addressee_id**: CHAR(36) - Usuario que recibe solicitud
- **status**: ENUM('pending', 'accepted', 'rejected', 'blocked') DEFAULT 'pending'
- **requested_at**: TIMESTAMP NOT NULL
- **responded_at**: TIMESTAMP NULLABLE
- **is_active**: BOOLEAN DEFAULT true
- **created_at**, **updated_at**

**Validaci√≥n:** No permite amistad consigo mismo  
**√çndice √∫nico:** (requester_id, addressee_id)

##### **9. Interests (tabla: `interests`)**
Intereses individuales de usuarios.

- **id**: UUID PK
- **user_id**: UUID - Usuario propietario
- **name**: VARCHAR(100) NOT NULL
- **category**: VARCHAR(50) - Categor√≠a del inter√©s
- **created_at** (sin updated_at)

**√çndice √∫nico:** (user_id, name)

##### **10. UserPreferences (tabla: `user_preferences`)**
Preferencias categorizadas de usuarios.

- **id**: CHAR(36) PK
- **user_id**: CHAR(36) UNIQUE
- **preferences**: JSON NOT NULL DEFAULT [] - Array de preferencias
- **created_at**, **updated_at**

**Valores v√°lidos:** ['Deportes', 'Arte', 'M√∫sica', 'Lectura', 'Tecnolog√≠a', 'Naturaleza', 'Voluntariado', 'Gaming', 'Fotograf√≠a', 'Cocina', 'Baile', 'Meditaci√≥n']

##### **11. CompleteProfiles (tabla: `complete_profiles`)**
Informaci√≥n complementaria del perfil.

- **id**: CHAR(36) PK
- **user_id**: CHAR(36) UNIQUE
- **full_name**: VARCHAR(100)
- **age**: INT (validaci√≥n: 1-120)
- **profile_picture**: VARCHAR(500)
- **bio**: TEXT (max 500 caracteres)
- **hobbies**: JSON DEFAULT []
- **location**: VARCHAR(100)
- **website**: VARCHAR(200) - Validado como URL
- **phone**: VARCHAR(20)
- **created_at**, **updated_at**

### üîß L√≥gica de Negocio

#### Use Cases Identificados

**Gesti√≥n de Perfiles:**
1. **Creaci√≥n de perfil**: Crea perfil social al registrarse desde auth-service
2. **Actualizaci√≥n de perfil**: Modifica datos p√∫blicos (display_name, bio, avatar, cover)
3. **Subida de im√°genes**: Integraci√≥n con Cloudinary para avatares y covers
4. **Consulta de perfiles**: B√∫squeda y visualizaci√≥n de perfiles p√∫blicos
5. **Actualizaci√≥n de m√©tricas**: Incremento/decremento de followers_count, posts_count

**Gesti√≥n de Publicaciones:**
1. **Crear publicaci√≥n**: Texto, imagen, video o mixto con validaci√≥n de tipo
2. **Subir multimedia**: Upload a Cloudinary con metadata completa
3. **Editar publicaci√≥n**: Actualizaci√≥n de contenido (marca is_edited)
4. **Eliminar publicaci√≥n**: Soft delete (is_active = false) o hard delete en cascada
5. **Filtrar por visibilidad**: public, private, friends
6. **Feed personalizado**: Publicaciones de amigos y comunidades seguidas
7. **Incremento de m√©tricas**: likes_count, comments_count, shares_count

**Sistema de Interacciones:**
1. **A√±adir reacci√≥n**: Like, love, wow, sad, angry a posts/comments
2. **Comentar**: Creaci√≥n de comentarios con soporte de respuestas anidadas (hasta nivel N)
3. **Responder comentarios**: parent_id apunta al comentario padre
4. **Editar comentario**: Actualiza content y marca is_edited + edited_at
5. **Eliminar comentario**: Soft delete preservando estructura de conversaci√≥n

**Gesti√≥n de Amistades:**
1. **Enviar solicitud**: Crea friendship con status='pending'
2. **Aceptar solicitud**: Cambia status a 'accepted', registra responded_at
3. **Rechazar solicitud**: status='rejected'
4. **Bloquear usuario**: status='blocked'
5. **Listar amigos**: Filtra por status='accepted' y is_active=true
6. **Sugerencias de amistad**: Basado en amigos en com√∫n y preferencias

**Gesti√≥n de Comunidades:**
1. **Crear comunidad**: Usuario se convierte en creator autom√°ticamente
2. **Unirse a comunidad**: A√±ade CommunityMember con role='member'
3. **Gesti√≥n de roles**: creator/admin puede asignar moderadores
4. **Listar comunidades**: Filtrado por categor√≠a, b√∫squeda por nombre/tags
5. **Feed de comunidad**: Publicaciones de miembros (pendiente implementaci√≥n)
6. **Actualizar members_count**: Incremento/decremento autom√°tico

**Preferencias e Intereses:**
1. **Guardar preferencias**: Array de categor√≠as predefinidas
2. **A√±adir intereses**: Intereses personalizados por usuario
3. **Matching de usuarios**: Algoritmo de compatibilidad basado en preferencias compartidas

### üí° L√≥gica de Aplicaci√≥n

**Arquitectura Clean Architecture:**
- **Domain:** Entidades de negocio puras
- **Application:** Use cases espec√≠ficos
- **Infrastructure:** Implementaci√≥n Sequelize, Cloudinary
- **Presentation:** Controladores Express y rutas

**Integraciones Externas:**
- **Cloudinary**: Upload de im√°genes/videos con transformaciones
- **Validaci√≥n:** Express-validator en todas las rutas
- **Paginaci√≥n:** Implementada en listados de posts, comments, communities

**Comunicaci√≥n entre Servicios:**
- user_id act√∫a como foreign key l√≥gica hacia auth-service
- No hay relaciones f√≠sicas entre bases de datos
- Validaci√≥n de user_id v√≠a JWT o consulta al auth-service

### üìç Ubicaci√≥n de Datos

```
MySQL Database: posts_dev_db
‚îú‚îÄ‚îÄ user_profiles (perfiles sociales)
‚îú‚îÄ‚îÄ complete_profiles (info adicional)
‚îú‚îÄ‚îÄ user_preferences (preferencias categorizadas)
‚îú‚îÄ‚îÄ interests (intereses personalizados)
‚îú‚îÄ‚îÄ posts (publicaciones)
‚îú‚îÄ‚îÄ media (archivos multimedia)
‚îú‚îÄ‚îÄ comments (comentarios con anidaci√≥n)
‚îú‚îÄ‚îÄ likes (reacciones polim√≥rficas)
‚îú‚îÄ‚îÄ communities (comunidades tem√°ticas)
‚îú‚îÄ‚îÄ community_members (membres√≠as)
‚îî‚îÄ‚îÄ friendships (relaciones de amistad)

Cloudinary (Storage externo):
‚îú‚îÄ‚îÄ Avatares de usuarios
‚îú‚îÄ‚îÄ Covers de perfiles
‚îú‚îÄ‚îÄ Im√°genes de publicaciones
‚îú‚îÄ‚îÄ Videos de publicaciones
‚îî‚îÄ‚îÄ Im√°genes de comunidades
```

---

## 3Ô∏è‚É£ AURA-MESSAGING-SERVICE

### üìä Capa de Persistencia

**Base de Datos:** MySQL  
**ORM:** Sequelize  
**Tecnolog√≠as:** Socket.io para WebSocket real-time

#### Modelos de Datos

##### **1. Messages (tabla: `messages`)**
Mensajes individuales en conversaciones o grupos.

- **id**: UUID PK
- **conversation_id**: UUID NULLABLE FK ‚Üí conversations.id
- **group_id**: UUID NULLABLE FK ‚Üí chat_groups.id
- **sender_profile_id**: UUID NOT NULL - Perfil del remitente
- **content**: TEXT NOT NULL - Contenido del mensaje
- **message_type**: ENUM('text', 'image', 'video', 'audio', 'file', 'system') DEFAULT 'text'
- **status**: ENUM('sent', 'delivered', 'read', 'failed') DEFAULT 'sent'
- **media_url**: VARCHAR(500) NULLABLE - URL de archivo multimedia
- **reply_to_id**: UUID NULLABLE - ID del mensaje al que responde
- **is_edited**: BOOLEAN DEFAULT false
- **is_deleted**: BOOLEAN DEFAULT false
- **metadata**: JSON DEFAULT {}
- **created_at**, **updated_at**

**Regla:** conversation_id XOR group_id (uno debe ser NULL, el otro NOT NULL)

##### **2. Conversations (tabla: `conversations`)**
Conversaciones 1:1 entre dos usuarios.

- **id**: UUID PK
- **participant1_profile_id**: UUID NOT NULL - Primer participante
- **participant2_profile_id**: UUID NOT NULL - Segundo participante
- **last_message_id**: UUID NULLABLE - √öltimo mensaje enviado
- **last_message_at**: TIMESTAMP NULLABLE
- **participant1_status**: ENUM('active', 'archived', 'blocked') DEFAULT 'active'
- **participant2_status**: ENUM('active', 'archived', 'blocked') DEFAULT 'active'
- **unread_count_1**: INT DEFAULT 0 - Mensajes no le√≠dos por participante 1
- **unread_count_2**: INT DEFAULT 0 - Mensajes no le√≠dos por participante 2
- **created_at**, **updated_at**

##### **3. Groups (tabla: `chat_groups`)**
Grupos de chat para m√∫ltiples usuarios.

- **id**: UUID PK
- **name**: VARCHAR(200) NOT NULL - Nombre del grupo
- **description**: TEXT
- **image_url**: VARCHAR(500) - Avatar del grupo
- **group_type**: ENUM('community', 'activity', 'private') DEFAULT 'community'
- **creator_profile_id**: UUID NOT NULL - Creador del grupo
- **external_id**: UUID NULLABLE - ID de comunidad externa (social-service)
- **max_members**: INT NULLABLE - L√≠mite de miembros
- **is_public**: BOOLEAN DEFAULT true
- **status**: ENUM('active', 'inactive', 'archived') DEFAULT 'active'
- **settings**: JSON DEFAULT {} - Configuraciones del grupo
- **member_count**: INT DEFAULT 0
- **last_message_at**: TIMESTAMP NULLABLE
- **location**: JSON NULLABLE - Ubicaci√≥n para actividades
- **scheduled_at**: TIMESTAMP NULLABLE - Fecha programada para actividades
- **created_at**, **updated_at**

##### **4. GroupMembers (tabla: `group_members`)**
Membres√≠as de usuarios en grupos.

- **id**: UUID PK
- **group_id**: UUID FK ‚Üí chat_groups.id
- **profile_id**: UUID NOT NULL - Usuario miembro
- **role**: ENUM('creator', 'admin', 'moderator', 'member') DEFAULT 'member'
- **unread_count**: INT DEFAULT 0
- **last_read_at**: TIMESTAMP NULLABLE
- **joined_at**: TIMESTAMP DEFAULT NOW
- **is_muted**: BOOLEAN DEFAULT false
- **created_at**, **updated_at**

##### **5. UserModel (tabla: `users`)**
Cach√© local de perfiles de usuarios para mensajer√≠a.

- **id**: UUID PK
- **profile_id**: UUID UNIQUE - Sincronizado con social-service
- **display_name**: VARCHAR(100)
- **avatar_url**: VARCHAR(500)
- **last_seen**: TIMESTAMP
- **is_online**: BOOLEAN DEFAULT false
- **created_at**, **updated_at**

### üîß L√≥gica de Negocio

#### Flujos Principales

**Mensajer√≠a 1:1:**
1. **Crear conversaci√≥n**: Valida que no exista conversaci√≥n entre participant1 y participant2
2. **Enviar mensaje**: 
   - Crea mensaje con status='sent'
   - Actualiza last_message_id y last_message_at de conversation
   - Incrementa unread_count del receptor
   - Emite evento Socket.io al receptor si est√° conectado
3. **Marcar como le√≠do**: 
   - Cambia status a 'read'
   - Resetea unread_count del lector
   - Emite confirmaci√≥n de lectura al remitente
4. **Obtener historial**: Paginaci√≥n de mensajes ordenados por created_at
5. **Archivar conversaci√≥n**: Cambia participant_status a 'archived'
6. **Bloquear usuario**: Cambia participant_status a 'blocked'

**Mensajer√≠a Grupal:**
1. **Crear grupo**: 
   - Define name, description, group_type
   - Creator se a√±ade autom√°ticamente como GroupMember con role='creator'
   - Si external_id existe, vincula con comunidad del social-service
2. **A√±adir miembros**: Crea GroupMember, incrementa member_count
3. **Enviar mensaje al grupo**:
   - Crea mensaje con group_id
   - Incrementa unread_count de todos los miembros excepto el sender
   - Emite mensaje via Socket.io a todos los miembros conectados
4. **Gesti√≥n de roles**: creator/admin pueden asignar moderadores
5. **Abandonar grupo**: Elimina GroupMember, decrementa member_count
6. **Silenciar grupo**: is_muted=true para notificaciones

**Funcionalidades de Mensajes:**
1. **Responder mensaje**: reply_to_id apunta al mensaje original
2. **Editar mensaje**: Actualiza content, marca is_edited=true
3. **Eliminar mensaje**: Soft delete (is_deleted=true) o hard delete
4. **Enviar multimedia**: Upload de imagen/video/audio, almacena media_url
5. **Mensajes de sistema**: message_type='system' para eventos (usuario unido, sali√≥, etc.)

**Estado de Presencia:**
1. **Actualizar estado online**: is_online=true al conectarse via Socket.io
2. **Last seen**: Actualiza last_seen al desconectarse
3. **Sincronizaci√≥n de perfil**: Actualiza display_name y avatar_url desde social-service

### üí° L√≥gica de Aplicaci√≥n

**Arquitectura DDD (Domain-Driven Design):**
- **Domain/Entities:** Message, Conversation, Group, GroupMember
- **Domain/Repositories:** Interfaces de persistencia
- **Infrastructure:** Implementaci√≥n Sequelize + Socket.io

**WebSocket (Socket.io):**
- **Conexi√≥n autenticada**: Valida JWT al conectar
- **Rooms din√°micos**: Un room por conversaci√≥n/grupo
- **Eventos:**
  - `message:send` - Env√≠o de mensaje
  - `message:delivered` - Confirmaci√≥n de entrega
  - `message:read` - Confirmaci√≥n de lectura
  - `typing:start` / `typing:stop` - Indicador de escritura
  - `user:online` / `user:offline` - Estado de presencia

**Integraciones:**
- **Social-Service**: Sincroniza perfiles de usuarios
- **Notifications-Service**: Env√≠a push notification cuando usuario offline
- **JWT**: Autenticaci√≥n compartida con auth-service

### üìç Ubicaci√≥n de Datos

```
MySQL Database (messaging_db)
‚îú‚îÄ‚îÄ messages (mensajes individuales)
‚îú‚îÄ‚îÄ conversations (chats 1:1)
‚îú‚îÄ‚îÄ chat_groups (grupos de chat)
‚îú‚îÄ‚îÄ group_members (membres√≠as)
‚îî‚îÄ‚îÄ users (cach√© de perfiles)

Socket.io In-Memory:
‚îú‚îÄ‚îÄ Conexiones activas de usuarios
‚îú‚îÄ‚îÄ Rooms de conversaciones
‚îî‚îÄ‚îÄ Rooms de grupos
```

---

## 4Ô∏è‚É£ NOTIFICATIONS-SERVICE-AURA

### üìä Capa de Persistencia

**Base de Datos:** PostgreSQL  
**ORM:** Prisma  
**Tecnolog√≠a:** Firebase Cloud Messaging (FCM)

#### Modelos de Datos

##### **1. UserDevices (tabla: `user_devices`)**
Tokens FCM de dispositivos registrados por usuario.

- **id**: UUID PK
- **userId**: VARCHAR - ID del usuario (desde auth-service)
- **fcmToken**: VARCHAR UNIQUE - Token FCM √∫nico por dispositivo
- **deviceInfo**: VARCHAR NULLABLE - Info del dispositivo (navegador, OS, modelo)
- **createdAt**: TIMESTAMP DEFAULT NOW
- **updatedAt**: TIMESTAMP (auto-actualizado)

**√çndice:** userId (b√∫squedas r√°pidas)  
**√çndice √∫nico:** fcmToken (previene duplicados)

### üîß L√≥gica de Negocio

#### Operaciones Principales

1. **Registrar dispositivo:**
   - Usuario env√≠a fcmToken al autenticarse
   - Almacena token con userId
   - deviceInfo opcional: User-Agent, plataforma

2. **Enviar notificaci√≥n push:**
   - **Notificaci√≥n individual**: Busca fcmTokens del userId destino
   - **Notificaci√≥n masiva**: Env√≠a a m√∫ltiples usuarios
   - **Payload FCM:**
     ```json
     {
       "notification": {
         "title": "T√≠tulo",
         "body": "Mensaje",
         "icon": "URL del √≠cono"
       },
       "data": {
         "type": "message|friend_request|like|comment",
         "entityId": "UUID",
         "click_action": "deep_link"
       }
     }
     ```

3. **Gesti√≥n de tokens:**
   - **Actualizar token**: Si cambia dispositivo o reinstala app
   - **Eliminar token**: Al hacer logout (sincronizado con auth-service)
   - **Limpiar tokens inv√°lidos**: FCM retorna error, elimina de BD

4. **Tipos de notificaciones soportadas:**
   - **Mensajes nuevos**: Desde aura-messaging-service
   - **Solicitudes de amistad**: Desde social-service
   - **Likes en publicaciones**: Desde social-service
   - **Comentarios**: Desde social-service
   - **Menciones**: Cuando usuario es etiquetado
   - **Eventos de comunidad**: Recordatorios de actividades

### üí° L√≥gica de Aplicaci√≥n

**Arquitectura:**
- **TypeScript** para type safety
- **Prisma** como ORM
- **Firebase Admin SDK** para FCM
- **Express** como framework HTTP

**Endpoints REST:**
- `POST /devices/register` - Registra nuevo token FCM
- `POST /notifications/send` - Env√≠a notificaci√≥n a usuario(s)
- `DELETE /devices/:fcmToken` - Elimina token al logout
- `GET /devices/user/:userId` - Lista dispositivos del usuario

**Integraci√≥n con Microservicios:**
- **Auth-service**: Obtiene userId de JWT
- **Messaging-service**: Escucha eventos de mensajes nuevos
- **Social-service**: Escucha eventos de interacciones sociales

**Manejo de Errores FCM:**
- `INVALID_TOKEN`: Elimina token de BD
- `NOT_REGISTERED`: Token expirado, elimina
- `MESSAGE_TOO_BIG`: Limita payload a 4KB
- Retry autom√°tico con backoff exponencial

### üìç Ubicaci√≥n de Datos

```
PostgreSQL Database
‚îî‚îÄ‚îÄ user_devices (tokens FCM)

Firebase Cloud Messaging
‚îî‚îÄ‚îÄ Push notifications en cola
```

---

## üìä RESUMEN DE DATOS ALMACENADOS

### PostgreSQL (Auth + Notifications)

| Tabla | Registros T√≠picos | Datos Sensibles |
|-------|-------------------|-----------------|
| users | Usuarios registrados | password_hash, email |
| roles | 2 (admin, user) | No |
| device_tokens | 1-5 por usuario | Tokens FCM |
| password_resets | Temporal (24h) | Tokens de reseteo |
| user_devices | 1-3 por usuario | Tokens FCM |

**Total estimado:** 5 tablas, crecimiento lineal con usuarios

### MySQL (Social + Messaging)

| Tabla | Registros T√≠picos | Volumen |
|-------|-------------------|---------|
| user_profiles | 1 por usuario | Alto |
| posts | N por usuario | Muy Alto |
| media | 1-10 por post | Muy Alto |
| comments | M por post | Muy Alto |
| likes | K por post/comment | Extremadamente Alto |
| communities | Cientos | Medio |
| friendships | N*(N-1)/2 (peor caso) | Alto |
| messages | Miles por conversaci√≥n | Extremadamente Alto |
| conversations | N*(N-1)/2 (peor caso) | Alto |
| chat_groups | Cientos | Medio |

**Total estimado:** 15 tablas, crecimiento exponencial

---

## üîó RELACIONES ENTRE MICROSERVICIOS

```mermaid
graph TB
    A[auth-service-aura] -->|user_id| B[social-service]
    A -->|user_id| C[aura-messaging-service]
    A -->|userId| D[notifications-service-aura]
    A -->|deviceToken| D
    B -->|profile_id| C
    B -->|eventos sociales| D
    C -->|nuevos mensajes| D
    B -->|external_id| C
```

**Sincronizaci√≥n:**
- **user_id** es el identificador com√∫n entre todos los servicios
- No hay foreign keys f√≠sicas entre bases de datos diferentes
- Validaci√≥n de integridad referencial v√≠a API calls o eventos

---

## üéØ USO DE DATOS A NIVEL DE NEGOCIO

### Auth-Service
- **Autenticaci√≥n y autorizaci√≥n**: Validaci√≥n de credenciales
- **Recuperaci√≥n de cuentas**: Reseteo de contrase√±as
- **Gesti√≥n de sesiones**: Tokens JWT y dispositivos
- **Control de acceso**: Roles y permisos

### Social-Service
- **Red social**: Publicaciones, likes, comentarios
- **Conexiones humanas**: Amistades y relaciones
- **Comunidades**: Agrupaci√≥n por intereses
- **Matching de usuarios**: Algoritmos de compatibilidad
- **Feed personalizado**: Contenido relevante por usuario
- **M√©tricas sociales**: Popularidad, engagement

### Messaging-Service
- **Comunicaci√≥n en tiempo real**: Chats 1:1 y grupales
- **Historial de conversaciones**: B√∫squeda y recuperaci√≥n
- **Estado de presencia**: Online/offline/last seen
- **Notificaciones de actividad**: Typing indicators
- **Integraci√≥n con comunidades**: Chats autom√°ticos por comunidad

### Notifications-Service
- **Push notifications**: Alertas en tiempo real
- **Gesti√≥n de dispositivos**: Multi-device support
- **Engagement**: Re-engagement de usuarios inactivos
- **Notificaciones transaccionales**: Confirmaciones de acciones

---

## ‚öôÔ∏è L√ìGICA DE APLICACI√ìN

### Patrones Arquitect√≥nicos

1. **Microservicios**: Separaci√≥n de responsabilidades
2. **Clean Architecture** (social-service): Domain ‚Üí Application ‚Üí Infrastructure ‚Üí Presentation
3. **DDD** (messaging-service): Entities, Repositories, Use Cases
4. **REST API**: Comunicaci√≥n HTTP entre servicios
5. **WebSockets**: Comunicaci√≥n en tiempo real (Socket.io)
6. **Event-Driven** (parcial): Notificaciones push basadas en eventos

### Seguridad

- **Autenticaci√≥n JWT**: Tokens compartidos entre servicios
- **Encriptaci√≥n bcrypt**: Password hashing con 10 salt rounds
- **CORS configurado**: Or√≠genes permitidos
- **Helmet**: Headers HTTP seguros
- **Validaci√≥n de entrada**: Express-validator en todas las rutas
- **Sanitizaci√≥n**: Prevenci√≥n de XSS e inyecci√≥n SQL (ORM)
- **HTTPS**: Requerido en producci√≥n

### Performance

- **√çndices en BD**: Optimizaci√≥n de queries frecuentes
- **Paginaci√≥n**: Limitaci√≥n de resultados en listados
- **Cach√© (potencial)**: Redis para sesiones y datos frecuentes
- **CDN**: Cloudinary para contenido multimedia
- **Conexiones persistentes**: Socket.io para chat
- **Lazy loading**: Media items cargados bajo demanda

### Escalabilidad

- **Bases de datos separadas**: Escalado horizontal independiente
- **Stateless APIs**: F√°cil balanceo de carga
- **ORM**: Abstracci√≥n de base de datos
- **Migraciones**: Sequelize/Prisma para versionado de esquemas

---

## üîç RECOMENDACIONES DE AN√ÅLISIS EXPLORATORIO

### 1. An√°lisis de Calidad de Datos

**Integridad Referencial:**
```sql
-- Verificar user_ids hu√©rfanos en social-service
SELECT DISTINCT user_id FROM user_profiles 
WHERE user_id NOT IN (SELECT user_id FROM auth_service.users);

-- Verificar posts sin perfil asociado
SELECT COUNT(*) FROM posts p
LEFT JOIN user_profiles up ON p.user_id = up.user_id
WHERE up.id IS NULL;
```

**Consistencia de M√©tricas:**
```sql
-- Validar followers_count vs relaciones reales
SELECT 
  user_id,
  followers_count,
  (SELECT COUNT(*) FROM friendships 
   WHERE addressee_id = user_id AND status = 'accepted') AS actual_followers
FROM user_profiles
WHERE followers_count != (SELECT COUNT(*) FROM friendships 
                          WHERE addressee_id = user_id AND status = 'accepted');
```

**Datos Duplicados:**
```sql
-- Usuarios con m√∫ltiples perfiles
SELECT user_id, COUNT(*) FROM user_profiles GROUP BY user_id HAVING COUNT(*) > 1;

-- Tokens FCM duplicados
SELECT fcmToken, COUNT(*) FROM user_devices GROUP BY fcmToken HAVING COUNT(*) > 1;
```

### 2. An√°lisis de Volumetr√≠a

**Crecimiento Temporal:**
```sql
-- Registros de usuarios por mes
SELECT DATE_FORMAT(created_at, '%Y-%m') AS mes, COUNT(*) 
FROM users GROUP BY mes ORDER BY mes;

-- Publicaciones por d√≠a (√∫ltimo mes)
SELECT DATE(created_at) AS fecha, COUNT(*) 
FROM posts 
WHERE created_at >= DATE_SUB(NOW(), INTERVAL 30 DAY)
GROUP BY fecha;
```

**Distribuci√≥n de Tipos:**
```sql
-- Distribuci√≥n de tipos de publicaciones
SELECT type, COUNT(*) AS total, 
       ROUND(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM posts), 2) AS porcentaje
FROM posts GROUP BY type;

-- Distribuci√≥n de tipos de mensajes
SELECT message_type, COUNT(*) 
FROM messages GROUP BY message_type;
```

### 3. An√°lisis de Relaciones

**Grafo Social:**
```sql
-- Usuarios m√°s conectados (influencers)
SELECT user_id, followers_count 
FROM user_profiles 
ORDER BY followers_count DESC LIMIT 20;

-- Densidad de red (ratio amistades/usuarios)
SELECT 
  (SELECT COUNT(*) FROM friendships WHERE status = 'accepted') AS amistades,
  (SELECT COUNT(*) FROM user_profiles) AS usuarios,
  (SELECT COUNT(*) FROM friendships WHERE status = 'accepted') * 1.0 / 
  (SELECT COUNT(*) FROM user_profiles) AS ratio_conectividad;
```

**Comunidades Activas:**
```sql
-- Comunidades con m√°s miembros
SELECT c.name, c.category, c.members_count
FROM communities c
ORDER BY c.members_count DESC LIMIT 20;

-- Comunidades sin actividad reciente
SELECT c.id, c.name, c.created_at
FROM communities c
LEFT JOIN community_members cm ON c.id = cm.community_id
WHERE cm.joined_at < DATE_SUB(NOW(), INTERVAL 90 DAY)
OR cm.id IS NULL;
```

### 4. An√°lisis de Engagement

**Engagement en Publicaciones:**
```sql
-- Posts con m√°s interacciones
SELECT 
  p.id,
  p.content,
  p.likes_count,
  p.comments_count,
  p.shares_count,
  (p.likes_count + p.comments_count * 2 + p.shares_count * 3) AS engagement_score
FROM posts p
ORDER BY engagement_score DESC LIMIT 50;

-- Usuarios m√°s activos (por publicaciones)
SELECT user_id, COUNT(*) AS total_posts
FROM posts
WHERE created_at >= DATE_SUB(NOW(), INTERVAL 30 DAY)
GROUP BY user_id
ORDER BY total_posts DESC LIMIT 20;
```

**Engagement en Mensajer√≠a:**
```sql
-- Conversaciones m√°s activas
SELECT conversation_id, COUNT(*) AS message_count
FROM messages
WHERE conversation_id IS NOT NULL
GROUP BY conversation_id
ORDER BY message_count DESC LIMIT 20;

-- Grupos m√°s activos
SELECT g.name, COUNT(m.id) AS message_count
FROM chat_groups g
LEFT JOIN messages m ON g.id = m.group_id
GROUP BY g.id, g.name
ORDER BY message_count DESC LIMIT 20;
```

### 5. An√°lisis de Retenci√≥n

**Usuarios Activos:**
```sql
-- DAU/WAU/MAU
SELECT 
  COUNT(DISTINCT CASE WHEN last_active_at >= DATE_SUB(NOW(), INTERVAL 1 DAY) 
        THEN user_id END) AS DAU,
  COUNT(DISTINCT CASE WHEN last_active_at >= DATE_SUB(NOW(), INTERVAL 7 DAY) 
        THEN user_id END) AS WAU,
  COUNT(DISTINCT CASE WHEN last_active_at >= DATE_SUB(NOW(), INTERVAL 30 DAY) 
        THEN user_id END) AS MAU
FROM user_profiles;

-- Tasa de retenci√≥n (usuarios activos en mes N que volvieron en mes N+1)
-- Requiere an√°lisis por cohortes
```

**Usuarios Inactivos:**
```sql
-- Usuarios fantasma (nunca crearon perfil social)
SELECT u.user_id, u.email, u.created_at
FROM users u
LEFT JOIN user_profiles up ON u.user_id = up.user_id
WHERE up.id IS NULL;

-- Usuarios registrados sin actividad reciente
SELECT user_id, display_name, last_active_at,
       DATEDIFF(NOW(), last_active_at) AS dias_inactivo
FROM user_profiles
WHERE last_active_at < DATE_SUB(NOW(), INTERVAL 60 DAY)
ORDER BY last_active_at;
```

### 6. An√°lisis de Preferencias e Intereses

**Categor√≠as Populares:**
```sql
-- Preferencias m√°s comunes
SELECT 
  JSON_UNQUOTE(JSON_EXTRACT(preferences, CONCAT('$[', numbers.n, ']'))) AS preferencia,
  COUNT(*) AS usuarios
FROM user_preferences
CROSS JOIN (SELECT 0 AS n UNION SELECT 1 UNION SELECT 2 UNION SELECT 3 
            UNION SELECT 4 UNION SELECT 5 UNION SELECT 6 UNION SELECT 7
            UNION SELECT 8 UNION SELECT 9 UNION SELECT 10 UNION SELECT 11) numbers
WHERE JSON_EXTRACT(preferences, CONCAT('$[', numbers.n, ']')) IS NOT NULL
GROUP BY preferencia
ORDER BY usuarios DESC;

-- Categor√≠as de comunidades m√°s populares
SELECT category, COUNT(*) AS total_comunidades, SUM(members_count) AS total_miembros
FROM communities
GROUP BY category
ORDER BY total_miembros DESC;
```

### 7. An√°lisis de Contenido Multimedia

**Storage Utilizado:**
```sql
-- Tama√±o total de media por tipo
SELECT 
  type,
  COUNT(*) AS archivos,
  SUM(size) / 1024 / 1024 / 1024 AS total_GB,
  AVG(size) / 1024 / 1024 AS promedio_MB
FROM media
GROUP BY type;

-- Posts con m√°s archivos multimedia
SELECT post_id, COUNT(*) AS media_count
FROM media
GROUP BY post_id
ORDER BY media_count DESC LIMIT 20;
```

### 8. An√°lisis de Seguridad

**Intentos de Recuperaci√≥n de Contrase√±a:**
```sql
-- Intentos fallidos o repetidos
SELECT user_id, COUNT(*) AS intentos
FROM password_resets
WHERE used = false AND expires_at < NOW()
GROUP BY user_id
HAVING COUNT(*) > 3;

-- Usuarios bloqueados
SELECT requester_id, COUNT(*) AS usuarios_bloqueados
FROM friendships
WHERE status = 'blocked'
GROUP BY requester_id
ORDER BY usuarios_bloqueados DESC;
```

### 9. An√°lisis de Dispositivos

**Diversidad de Plataformas:**
```sql
-- Distribuci√≥n de dispositivos
SELECT 
  CASE 
    WHEN deviceInfo LIKE '%Android%' THEN 'Android'
    WHEN deviceInfo LIKE '%iOS%' THEN 'iOS'
    WHEN deviceInfo LIKE '%Windows%' THEN 'Windows'
    WHEN deviceInfo LIKE '%Mac%' THEN 'Mac'
    ELSE 'Otros'
  END AS plataforma,
  COUNT(*) AS dispositivos
FROM user_devices
GROUP BY plataforma;

-- Usuarios con m√∫ltiples dispositivos
SELECT userId, COUNT(*) AS num_dispositivos
FROM user_devices
GROUP BY userId
HAVING COUNT(*) > 1
ORDER BY num_dispositivos DESC;
```

### 10. Machine Learning / Recomendaciones

**Features para Algoritmos:**
- **User Profiling**: preferences, interests, hobbies, communities joined
- **Content-Based Filtering**: tags en posts, categor√≠as de comunidades
- **Collaborative Filtering**: likes compartidos, amigos en com√∫n
- **Graph Analysis**: PageRank de usuarios, detecci√≥n de comunidades
- **Engagement Prediction**: patrones de actividad temporal
- **Churn Prediction**: d√≠as de inactividad, decrecimiento de engagement

**Datasets Sugeridos:**
```sql
-- Dataset para sistema de recomendaci√≥n de usuarios
SELECT 
  u.user_id,
  u.followers_count,
  u.following_count,
  u.posts_count,
  up.preferences,
  GROUP_CONCAT(i.name) AS interests,
  GROUP_CONCAT(c.category) AS comunidades
FROM user_profiles u
LEFT JOIN user_preferences up ON u.user_id = up.user_id
LEFT JOIN interests i ON u.user_id = i.user_id
LEFT JOIN community_members cm ON u.user_id = cm.user_id
LEFT JOIN communities c ON cm.community_id = c.id
GROUP BY u.user_id;
```

---

## üìà M√âTRICAS CLAVE (KPIs) A MONITOREAR

### M√©tricas de Usuario
- **Total de usuarios registrados** (auth-service.users)
- **Usuarios con perfil completo** (social-service.user_profiles)
- **DAU/WAU/MAU** (last_active_at)
- **Tasa de conversi√≥n** (registro ‚Üí perfil completo)
- **Churn rate** (usuarios inactivos > 30 d√≠as)

### M√©tricas de Contenido
- **Total de publicaciones** (posts.count)
- **Posts por usuario** (AVG posts_count)
- **Engagement rate** ((likes + comments) / posts)
- **Contenido multimedia** (% posts con media)
- **Comentarios por post** (AVG comments_count)

### M√©tricas Sociales
- **Amistades activas** (friendships.status = 'accepted')
- **Tasa de aceptaci√≥n** (accepted / (accepted + rejected))
- **Comunidades activas** (communities.is_active = true)
- **Miembros promedio por comunidad** (AVG members_count)
- **Usuarios verificados** (is_verified = true)

### M√©tricas de Mensajer√≠a
- **Mensajes enviados/d√≠a** (messages por d√≠a)
- **Conversaciones activas** (last_message_at reciente)
- **Usuarios en tiempo real** (Socket.io connections)
- **Tasa de respuesta** (mensajes bidireccionales)
- **Grupos activos** (chat_groups con mensajes recientes)

### M√©tricas de Notificaciones
- **Dispositivos registrados** (user_devices)
- **Notificaciones enviadas/d√≠a** (FCM logs)
- **Tasa de apertura** (click-through rate)
- **Tokens inv√°lidos** (errores FCM)

---

## üö® POTENCIALES PROBLEMAS IDENTIFICADOS

### Escalabilidad
1. **Likes table**: Crecimiento extremadamente r√°pido, considerar particionamiento
2. **Messages table**: Retenci√≥n infinita, implementar archivado de mensajes antiguos
3. **Media storage**: Sin l√≠mite de uploads, implementar cuotas por usuario
4. **Conexiones Socket.io**: Limitadas por memoria del servidor, considerar clustering

### Seguridad
1. **Password resets**: Sin rate limiting, vulnerable a spam
2. **Device tokens**: Sin rotaci√≥n autom√°tica de tokens FCM
3. **User_id validation**: No hay validaci√≥n de existencia en auth-service desde otros servicios
4. **CORS**: Configuraci√≥n debe ser revisada para producci√≥n

### Consistencia de Datos
1. **M√©tricas denormalizadas**: followers_count, posts_count pueden desincronizarse
2. **Cascade deletes**: Eliminaci√≥n de usuario no propagada a social/messaging services
3. **Orphaned records**: user_id en social-service sin registro en auth-service

### Performance
1. **N+1 queries**: Potencial en relaciones Sequelize sin eager loading
2. **JSON fields**: B√∫squeda en preferences/metadata no indexada
3. **Sin cach√©**: Todas las queries van directo a BD
4. **Media URLs**: Sin CDN cache headers configurados

---

## ‚úÖ CONCLUSIONES

### Fortalezas del Sistema
‚úÖ Arquitectura de microservicios bien separada  
‚úÖ Uso apropiado de bases de datos (PostgreSQL para transaccional, MySQL para contenido)  
‚úÖ ORM modernos (Prisma, Sequelize) con migrations  
‚úÖ Real-time capabilities (Socket.io)  
‚úÖ Push notifications integradas (FCM)  
‚úÖ Seguridad b√°sica implementada (JWT, bcrypt, Helmet)  
‚úÖ Validaci√≥n de entrada en todas las rutas  

### √Åreas de Mejora Cr√≠ticas
‚ö†Ô∏è **Comunicaci√≥n entre servicios**: Implementar message broker (RabbitMQ, Kafka)  
‚ö†Ô∏è **Sincronizaci√≥n de datos**: Eventos para propagar cambios de usuarios  
‚ö†Ô∏è **Cach√© distribuido**: Redis para sesiones y datos frecuentes  
‚ö†Ô∏è **Monitoreo**: Logging centralizado y m√©tricas (Prometheus, Grafana)  
‚ö†Ô∏è **Testing**: Cobertura de tests unitarios e integraci√≥n  
‚ö†Ô∏è **Documentaci√≥n API**: Swagger/OpenAPI para cada servicio  
‚ö†Ô∏è **Rate limiting**: Protecci√≥n contra abuso de APIs  
‚ö†Ô∏è **Backup y recuperaci√≥n**: Estrategia de respaldo de bases de datos  

### Siguiente Fase Recomendada
1. **Implementar API Gateway**: Kong o NGINX para routing centralizado
2. **Service Discovery**: Consul o Eureka para registro de servicios
3. **Distributed Tracing**: Jaeger para debugging de requests entre servicios
4. **Circuit Breaker**: Resilience patterns para fallos de servicios
5. **Database Sharding**: Para escalar horizontalmente cuando sea necesario

---

**Documento generado:** 2025-11-27  
**Versi√≥n del an√°lisis:** 1.0  
**Autor:** An√°lisis automatizado de arquitectura
